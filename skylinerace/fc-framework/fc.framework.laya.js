window.fc=window.fc||{},window.fc.framework=window.fc.framework||{},function(t,s){"use strict";var e=fc.define.Event,i=fc.define.ViewEnum,n=fc.define.GameState;class a{static hex_md5(t){return this.binl2hex(this.core_md5(this.str2binl(t),t.length*this.chrsz))}static b64_md5(t){return this.binl2b64(this.core_md5(this.str2binl(t),t.length*this.chrsz))}static str_md5(t){return this.binl2str(this.core_md5(this.str2binl(t),t.length*this.chrsz))}static hex_hmac_md5(t,s){return this.binl2hex(this.core_hmac_md5(t,s))}static b64_hmac_md5(t,s){return this.binl2b64(this.core_hmac_md5(t,s))}static str_hmac_md5(t,s){return this.binl2str(this.core_hmac_md5(t,s))}static hex_md5(t){return this.binl2hex(this.core_md5(this.str2binl(t),t.length*this.chrsz))}static b64_md5(t){return this.binl2b64(this.core_md5(this.str2binl(t),t.length*this.chrsz))}static str_md5(t){return this.binl2str(this.core_md5(this.str2binl(t),t.length*this.chrsz))}static hex_hmac_md5(t,s){return this.binl2hex(this.core_hmac_md5(t,s))}static b64_hmac_md5(t,s){return this.binl2b64(this.core_hmac_md5(t,s))}static str_hmac_md5(t,s){return this.binl2str(this.core_hmac_md5(t,s))}static core_md5(t,s){t[s>>5]|=128<<s%32,t[14+(s+64>>>9<<4)]=s;for(var e=1732584193,i=-271733879,n=-1732584194,a=271733878,h=0;h<t.length;h+=16){var r=e,o=i,c=n,l=a;e=this.md5_ff(e,i,n,a,t[h+0],7,-680876936),a=this.md5_ff(a,e,i,n,t[h+1],12,-389564586),n=this.md5_ff(n,a,e,i,t[h+2],17,606105819),i=this.md5_ff(i,n,a,e,t[h+3],22,-1044525330),e=this.md5_ff(e,i,n,a,t[h+4],7,-176418897),a=this.md5_ff(a,e,i,n,t[h+5],12,1200080426),n=this.md5_ff(n,a,e,i,t[h+6],17,-1473231341),i=this.md5_ff(i,n,a,e,t[h+7],22,-45705983),e=this.md5_ff(e,i,n,a,t[h+8],7,1770035416),a=this.md5_ff(a,e,i,n,t[h+9],12,-1958414417),n=this.md5_ff(n,a,e,i,t[h+10],17,-42063),i=this.md5_ff(i,n,a,e,t[h+11],22,-1990404162),e=this.md5_ff(e,i,n,a,t[h+12],7,1804603682),a=this.md5_ff(a,e,i,n,t[h+13],12,-40341101),n=this.md5_ff(n,a,e,i,t[h+14],17,-1502002290),i=this.md5_ff(i,n,a,e,t[h+15],22,1236535329),e=this.md5_gg(e,i,n,a,t[h+1],5,-165796510),a=this.md5_gg(a,e,i,n,t[h+6],9,-1069501632),n=this.md5_gg(n,a,e,i,t[h+11],14,643717713),i=this.md5_gg(i,n,a,e,t[h+0],20,-373897302),e=this.md5_gg(e,i,n,a,t[h+5],5,-701558691),a=this.md5_gg(a,e,i,n,t[h+10],9,38016083),n=this.md5_gg(n,a,e,i,t[h+15],14,-660478335),i=this.md5_gg(i,n,a,e,t[h+4],20,-405537848),e=this.md5_gg(e,i,n,a,t[h+9],5,568446438),a=this.md5_gg(a,e,i,n,t[h+14],9,-1019803690),n=this.md5_gg(n,a,e,i,t[h+3],14,-187363961),i=this.md5_gg(i,n,a,e,t[h+8],20,1163531501),e=this.md5_gg(e,i,n,a,t[h+13],5,-1444681467),a=this.md5_gg(a,e,i,n,t[h+2],9,-51403784),n=this.md5_gg(n,a,e,i,t[h+7],14,1735328473),i=this.md5_gg(i,n,a,e,t[h+12],20,-1926607734),e=this.md5_hh(e,i,n,a,t[h+5],4,-378558),a=this.md5_hh(a,e,i,n,t[h+8],11,-2022574463),n=this.md5_hh(n,a,e,i,t[h+11],16,1839030562),i=this.md5_hh(i,n,a,e,t[h+14],23,-35309556),e=this.md5_hh(e,i,n,a,t[h+1],4,-1530992060),a=this.md5_hh(a,e,i,n,t[h+4],11,1272893353),n=this.md5_hh(n,a,e,i,t[h+7],16,-155497632),i=this.md5_hh(i,n,a,e,t[h+10],23,-1094730640),e=this.md5_hh(e,i,n,a,t[h+13],4,681279174),a=this.md5_hh(a,e,i,n,t[h+0],11,-358537222),n=this.md5_hh(n,a,e,i,t[h+3],16,-722521979),i=this.md5_hh(i,n,a,e,t[h+6],23,76029189),e=this.md5_hh(e,i,n,a,t[h+9],4,-640364487),a=this.md5_hh(a,e,i,n,t[h+12],11,-421815835),n=this.md5_hh(n,a,e,i,t[h+15],16,530742520),i=this.md5_hh(i,n,a,e,t[h+2],23,-995338651),e=this.md5_ii(e,i,n,a,t[h+0],6,-198630844),a=this.md5_ii(a,e,i,n,t[h+7],10,1126891415),n=this.md5_ii(n,a,e,i,t[h+14],15,-1416354905),i=this.md5_ii(i,n,a,e,t[h+5],21,-57434055),e=this.md5_ii(e,i,n,a,t[h+12],6,1700485571),a=this.md5_ii(a,e,i,n,t[h+3],10,-1894986606),n=this.md5_ii(n,a,e,i,t[h+10],15,-1051523),i=this.md5_ii(i,n,a,e,t[h+1],21,-2054922799),e=this.md5_ii(e,i,n,a,t[h+8],6,1873313359),a=this.md5_ii(a,e,i,n,t[h+15],10,-30611744),n=this.md5_ii(n,a,e,i,t[h+6],15,-1560198380),i=this.md5_ii(i,n,a,e,t[h+13],21,1309151649),e=this.md5_ii(e,i,n,a,t[h+4],6,-145523070),a=this.md5_ii(a,e,i,n,t[h+11],10,-1120210379),n=this.md5_ii(n,a,e,i,t[h+2],15,718787259),i=this.md5_ii(i,n,a,e,t[h+9],21,-343485551),e=this.safe_add(e,r),i=this.safe_add(i,o),n=this.safe_add(n,c),a=this.safe_add(a,l)}return Array(e,i,n,a)}static md5_cmn(t,s,e,i,n,a){return this.safe_add(this.bit_rol(this.safe_add(this.safe_add(s,t),this.safe_add(i,a)),n),e)}static md5_ff(t,s,e,i,n,a,h){return this.md5_cmn(s&e|~s&i,t,s,n,a,h)}static md5_gg(t,s,e,i,n,a,h){return this.md5_cmn(s&i|e&~i,t,s,n,a,h)}static md5_hh(t,s,e,i,n,a,h){return this.md5_cmn(s^e^i,t,s,n,a,h)}static md5_ii(t,s,e,i,n,a,h){return this.md5_cmn(e^(s|~i),t,s,n,a,h)}static core_hmac_md5(t,s){var e=this.str2binl(t);e.length>16&&(e=this.core_md5(e,t.length*this.chrsz));for(var i=Array(16),n=Array(16),a=0;a<16;a++)i[a]=909522486^e[a],n[a]=1549556828^e[a];var h=this.core_md5(i.concat(this.str2binl(s)),512+s.length*this.chrsz);return this.core_md5(n.concat(h),640)}static safe_add(t,s){var e=(65535&t)+(65535&s);return(t>>16)+(s>>16)+(e>>16)<<16|65535&e}static bit_rol(t,s){return t<<s|t>>>32-s}static str2binl(t){for(var s=Array(),e=(1<<this.chrsz)-1,i=0;i<t.length*this.chrsz;i+=this.chrsz)s[i>>5]|=(t.charCodeAt(i/this.chrsz)&e)<<i%32;return s}static binl2str(t){for(var s="",e=(1<<this.chrsz)-1,i=0;i<32*t.length;i+=this.chrsz)s+=String.fromCharCode(t[i>>5]>>>i%32&e);return s}static binl2hex(t){for(var s=this.hexcase?"0123456789ABCDEF":"0123456789abcdef",e="",i=0;i<4*t.length;i++)e+=s.charAt(t[i>>2]>>i%4*8+4&15)+s.charAt(t[i>>2]>>i%4*8&15);return e}static binl2b64(t){for(var s="",e=0;e<4*t.length;e+=3)for(var i=(t[e>>2]>>e%4*8&255)<<16|(t[e+1>>2]>>(e+1)%4*8&255)<<8|t[e+2>>2]>>(e+2)%4*8&255,n=0;n<4;n++)8*e+6*n>32*t.length?s+=this.b64pad:s+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(i>>6*(3-n)&63);return s}}a.hexcase=0,a.b64pad="",a.chrsz=8,s.ILaya.regClass(a),s.ClassUtils.regClass("fc.framework.Md5Utils",a);class h{static compareVersion(t,s){t=t.split("."),s=s.split(".");for(var e=Math.max(t.length,s.length);t.length<e;)t.push("0");for(;s.length<e;)s.push("0");for(var i=0;i<e;i++){var n=parseInt(t[i]),a=parseInt(s[i]);if(n>a)return 1;if(n<a)return-1}return 0}static isToday(t){var s=new Date(Date.now()),e=new Date(t);return s.getFullYear()==e.getFullYear()&&s.getMonth()==e.getMonth()&&s.getDate()==e.getDate()}static random(t,s){return Math.random()*(s-t)+t<<0}static isNumber(t){return!(!/^\d+(\.\d+)?$/.test(t)&&!/^(-(([0-9]+\.[0-9]*[1-9][0-9]*)|([0-9]*[1-9][0-9]*\.[0-9]+)|([0-9]*[1-9][0-9]*)))$/.test(t))}static array2UrlStrArgs(t){if(!t||0==t.length)return"";if(1==t.length)return t[0];for(var s=t[0]+"="+t[1],e=2;e+1<t.length;e+=2)s+="&"+t[e]+"="+t[e+1];return s}static object2UrlStrArgs(t){if(t){var s="";for(var e in t)t.hasOwnProperty(e)&&(s+=e+"="+t[e]+"&");return s.substr(0,s.length-1)}return""}}s.ILaya.regClass(h),s.ClassUtils.regClass("fc.framework.MiscUtils",h);class r{static get Instance(){0==this.sInitialized&&(this.sInitialized=!0,this.sInstance=fc.adapter.Channel,this.sInstance&&this.sInstance.init())}static login(t,s){this.Instance&&this.Instance.login?this.Instance.login(t,s):s&&(s.runWith({code:1,desc:"web login"}),console.warn("Channel","login is not exist"))}static loadSubpackage(t,s,e,i){return this.Instance&&this.Instance.loadSubpackage?this.Instance.loadSubpackage(t,s,e,i):(e&&(e.run(),console.warn("Channel","loadSubpackage is not exist")),!1)}static initVideoAd(t){this.Instance&&this.Instance.initVideoAD?this.Instance.initVideoAD(t):console.warn("Channel","initVideoAd is not exist")}static playVideo(t,e,i){this.Instance&&this.Instance.playVideo?(s.stage.event(this.EVENT_AD_VIDEO_PLAY),this.Instance.playVideo(s.Handler.create(null,function(){s.stage.event(this.EVENT_AD_VIDEO_CLOSED),t&&t.run()},null,!1),s.Handler.create(null,function(){s.stage.event(this.EVENT_AD_VIDEO_CLOSED),e&&e.run()},null,!1),s.Handler.create(null,function(t){s.stage.event(this.EVENT_AD_VIDEO_CLOSED),i&&i.runWith(t)},null,!1))):t&&(t.run(),console.warn("Channel","playVideo is not exist"))}static isVideoEnable(){return this.Instance&&this.Instance.isVideoEnable?this.Instance.isVideoEnable():(console.warn("Channel","isVideoEnable is not exist"),!1)}static openShare(t,s){this.Instance&&this.Instance.openShare?this.Instance.openShare(t,s):console.warn("Channel","openShare is not exist",t,s)}static initInsertAd(t,s){this.Instance?this.Instance.initInsertAd?this.Instance.initInsertAd(t,s):this.Instance.initFullScreenAD&&this.Instance.initFullScreenAD(t,s):console.warn("Channel","initInsertAd is not exist")}static loadInsertAd(t,s){this.Instance?this.Instance.loadInsertAd?this.Instance.loadInsertAd(t,s):this.Instance.loadFullScreenAD&&this.Instance.loadFullScreenAD(t,s):s&&(s.runWith("null"),console.warn("Channel","loadInsertAd is not exist"))}static showInsertAd(t){this.Instance?this.Instance.showInsertAd?this.Instance.showInsertAd(t):this.Instance.loadFullScreenAD&&this.Instance.showFullScreenAD(t):(t&&t.runWith("invalid channel"),console.warn("Channel","showInsertAd is not exist"))}}r.sInstance=null,r.sInitialized=!1,r.EVENT_AD_VIDEO_PLAY=e.AD_VIDEO_PLAY,r.EVENT_AD_VIDEO_CLOSED=e.AD_VIDEO_CLOSED,s.ILaya.regClass(r),s.ClassUtils.regClass("fc.framework.Channel",r);class o{static get Instance(){0==this.sInitialized&&(this.sInitialized=!0,this.sInstance=fc.adapter.Device,this.sInstance&&this.sInstance.init(s.Handler.create(this,function(t){s.stage.event(this.EVENT_ON_SHOW,t)},null,!1),s.Handler.create(this,function(){s.stage.event(this.EVENT_ON_HIDE)},null,!1)))}static get statusBarHeight(){return this.Instance&&this.Instance.statusBarHeight?this.Instance.statusBarHeight:0}static get screenWidth(){return this.Instance&&this.Instance.screenWidth?this.Instance.screenWidth:s.stage.width}static get screenHeight(){return this.Instance&&this.Instance.screenHeight?this.Instance.screenHeight:s.stage.height}static playSound(t,e,i){this.Instance&&this.Instance.playSound?this.Instance.playSound(t,e,i):s.SoundManager.playSound(t,e?0:1,i)}static stopSound(t){this.Instance&&this.Instance.stopSound?this.Instance.stopSound(t):s.SoundManager.stopSound(t)}static playMusic(t){this.Instance&&this.Instance.playMusic?this.Instance.playMusic(t):s.SoundManager.playMusic(t,0)}static stopMusic(t){this.Instance&&this.Instance.stopMusic?this.Instance.stopMusic(t):s.SoundManager.stopMusic(t)}static stopAll(){this.stopMusic(),this.stopAllSound()}static stopAllSound(){this.Instance&&this.Instance.stopAllSound?this.Instance.stopAllSound():s.SoundManager.stopAllSound()}static vibrateShort(){this.Instance&&this.Instance.vibrateShort?this.Instance.vibrateShort():"undefined"!=typeof navigator&&"vibrate"in navigator?navigator.vibrate(500):(console.log("vibrateShort"),console.warn("Device","vibrateShort is not exist"))}static vibrateLong(){this.Instance&&this.Instance.vibrateLong?this.Instance.vibrateLong():"undefined"!=typeof navigator&&"vibrate"in navigator?navigator.vibrate(1e3):(console.log("vibrateLong"),console.warn("Device","vibrateLong is not exist"))}static isNetValid(){return this.Instance&&this.Instance.isNetValid?this.Instance.isNetValid():navigator.onLine}}o.sInstance=null,o.sInitialized=!1,o.EVENT_ON_HIDE=e.Device_HIDE,o.EVENT_ON_SHOW=e.Device_SHOW,o.EVENT_ON_RESUME=e.Device_RESUME,s.ILaya.regClass(o),s.ClassUtils.regClass("fc.framework.Device",o);class c{static get IsBgmPlaying(){return this.sIsBgmPlaying}static playMusic(t){null!=t&&(this.sCurMusicUrl==t&&this.sIsBgmPlaying||(this.sCurMusicUrl=t,this.sIsBgmPlaying=!0,o.stopMusic(),o.playMusic(this.sCurMusicUrl,0)))}static stopMusic(){o.stopMusic(this.sCurMusicUrl),this.sIsBgmPlaying=!1}static playSound(t,e){e&&-1!=this.sLoopSounds.indexOf(t)||(o.playSound(t,1,e?s.Handler.create(this,this.onSoundCompleted,[t]):null),e&&this.sLoopSounds.push(t))}static stopSound(t){var s=this.sLoopSounds.indexOf(t);-1!=s&&this.sLoopSounds.splice(s,1),o.stopSound(t)}static onSoundCompleted(t){-1!=this.sLoopSounds.indexOf(t)&&o.playSound(t,1,s.Handler.create(this,this.onSoundCompleted,[t]))}static stopAll(){this.stopMusic(),this.stopAllSound()}static stopAllSound(){o.stopAllSound(),this.sLoopSounds.splice(0)}}c.sCurMusicUrl=null,c.sIsBgmPlaying=!1,c.sLoopSounds=[],s.ILaya.regClass(c),s.ClassUtils.regClass("fc.framework.Audio",c);class l{static get3dResUrl(t){return this.threeDResRootPath+t}static get3dPrefabUrl(t){return this.threeDResRootPath+t+".lh"}static get3dSceneUrl(t){return this.threeDResRootPath+t+".ls"}static get curScene3dUrl(){return this.curScene3d?this.curScene3d.fc_res_url:null}static loadSubpackage(t,s,e){r.loadSubpackage(t,e,s,s)}static loadFont(t,e,i){var n=new s.BitmapFont;t instanceof Array?n.loadFont(`font/${t[0]}.fnt`,s.Handler.create(this,this.onFontReady,[n,t[0],t,e,i])):n.loadFont(`font/${t}.fnt`,s.Handler.create(this,this.onFontReady,[n,t,[],e,i]))}static onFontReady(t,e,i,n,a){if(s.Text.registerBitmapFont(e,t),0==i.length)n&&n.run(),a&&a.runWith(1);else{var h=i.indexOf(e)+1;h==i.length?(n&&n.run(),a&&a.runWith(1)):(t.loadFont(`font/${i[h]}.fnt`,s.Handler.create(this,this.onFontReady,[t,i[h],i,n,a])),a&&a.runWith(h/i.length))}}static loadRes(t){return s.loader.getRes(t)}static loadResAsyn(t,e,i,n){Array,s.loader.load(t,e,i)}static load3dRes(t){return s.loader.getRes(t)}static load3dResAsyn(t,e,i,n){Array,s.loader.create(t,e,i)}static loadSprite3d(t,s){return this.load3dRes(this.get3dPrefabUrl(t))}static loadSprite3dAsyn(t,s,e,i){if(t instanceof Array){var n=[];for(let s=0;s<t.length;s++)n.push(this.get3dPrefabUrl(t[s]));this.load3dResAsyn(n,s,e)}else{var a=this.get3dPrefabUrl(t);this.load3dResAsyn(a,s,e)}}static loadScene3d(t,e){var i=this.curScene3d;this.curScene3d=null;var n=null!=i?i.fc_scene_url:null;return i&&(i.removeSelf(),i.destroy(),i=null),this.curScene3d=s.loader.getRes(this.get3dSceneUrl(t)),this.curScene3d&&(this.curScene3d.fc_scene_url=t),n&&this.unloadSceneRes(n),this.curScene3d}static loadScene3dAsyn(t,e,i){this.curDownloadSceneUrl!=t&&s.loader.cancelLoadByUrl(this.curDownloadSceneUrl),this.curDownloadSceneUrl=null;var n=this.curScene3d;this.curScene3d=null;var a=null!=n?n.fc_scene_url:null;n&&(n.removeSelf(),n.destroy(),n=null,s.loader.clearRes(a));var h=this.get3dSceneUrl(t);if(this.curScene3d=s.loader.getRes(h),this.curScene3d)return this.curScene3d.fc_scene_url=t,a&&this.unloadSceneRes(a),i&&i.runWith(1),e&&e.runWith(this.curScene3d),this.curScene3d;this.curDownloadSceneUrl=h;var r=this;return s.loader.create(h,s.Handler.create(null,function(s){r.curDownloadSceneUrl=null,r.curScene3d=s,r.curScene3d&&(r.curScene3d.fc_scene_url=t),a&&r.unloadSceneRes(a),e&&e.runWith(r.curScene3d)}),i),null}static unloadSceneRes(t){s.loader.load(this.get3dResUrl(t+".json"),s.Handler.create(this,this.destroyScene3dRes,[this.get3dResUrl(t+".json")]))}static printSceneDependences(t){s.loader.load(this.get3dResUrl(t+".json"),s.Handler.create(this,this.printScene3dRes,[this.get3dResUrl(t+".json")]))}static printScene3dRes(t){var e=s.loader.getRes(t);if(null!=e)for(var i={},n=e.length-1;n>-1;n--){var a=this.get3dResUrl(e[n]),h=s.loader.getRes(a);null==h||(i[a]=h.referenceCount)}}static destroyScene3dRes(t){var e=s.loader.getRes(t);if(null!=e)for(var i=e.length-1;i>-1;i--){var n=this.get3dResUrl(e[i]),a=s.loader.getRes(n);null==a||a.referenceCount>0||(a.destroy(),s.loader.clearRes(n))}}}l.curScene3d=null,l.curDownloadSceneUrl=null,l.threeDResRootPath="3dres/Conventional/",s.ILaya.regClass(l),s.ClassUtils.regClass("fc.framework.Resource",l);class d{static getArgsSign(t,s){for(var e=Object.keys(t).sort(),i="",n=0;n<e.length;n++)i+=e[n]+"="+t[e[n]];return s&&(i+=s),a.hex_md5(i).toLowerCase()}static xhrPost(t,e){if(null==this.sXHRList[t]){this.sXHRList[t]=Date.now();var i=h.object2UrlStrArgs(e),n=new s.HttpRequest;n.http.timeout=1e4,n.once(s.Event.ERROR,this,this.onXHRError,[t,e]),n.once(s.Event.COMPLETE,this,this.onXHRCompleted,[t,e]),n.send(t,i,"post","text")}}static xhrPostWithSign(t,e,i){if(null==this.sXHRList[t]){this.sXHRList[t]=Date.now(),e.sign=this.getArgsSign(e,i);var n=h.object2UrlStrArgs(e),a=new s.HttpRequest;a.http.timeout=1e4,a.once(s.Event.ERROR,this,this.onXHRError,[t,e]),a.once(s.Event.COMPLETE,this,this.onXHRCompleted,[t,e]),a.send(t,n,"post","text")}}static xhrPostWithSignAndHeader(t,e,i,n){if(null==this.sXHRList[t]){this.sXHRList[t]=Date.now(),e.sign=this.getArgsSign(e,i);for(var a=["Content-Type","application/x-www-form-urlencoded"],r=Object.keys(n),o=0;o<r.length;o++)a.push(r[o]),a.push(n[r[o]]);var c=h.object2UrlStrArgs(e),l=new s.HttpRequest;l.http.timeout=1e4,l.once(s.Event.ERROR,this,this.onXHRError,[t,e]),l.once(s.Event.COMPLETE,this,this.onXHRCompleted,[t,e]),l.send(t,c,"post","text",a)}}static onXHRError(t,e,i){this.sXHRList[t]=null,console.log("onXHRError:"+t+",params:"+JSON.stringify(e)+",response:"+i),s.stage.event(this.NET_XHR_RESPONSE,[0,t,e,i])}static onXHRCompleted(t,e,i){this.sXHRList[t]=null;var n=JSON.parse(i);n.code&&200==n.code?null!=n.data?1==n.data.status?s.stage.event(this.NET_XHR_RESPONSE,[1,t,e,n]):s.stage.event(this.NET_XHR_RESPONSE,[0,t,e,n.data.msg]):s.stage.event(this.NET_XHR_RESPONSE,[0,t,e,"登陆失败，数据体为空"]):s.stage.event(this.NET_XHR_RESPONSE,[0,t,e,n.msg])}}d.XHR_RESPONSE=e.XHR_RESPONSE,d.sXHRList={},s.ILaya.regClass(d),s.ClassUtils.regClass("fc.framework.WebRequest",d);class g{static startUp(){s.stage.on(e.GAME_HOME,this,this.onGameHome),s.stage.on(e.GAME_PREPARE,this,this.onGamePrepare),s.stage.on(e.GAME_START,this,this.onGameStart),s.stage.on(e.GAME_FAILED,this,this.onGameFailed),s.stage.on(e.GAME_WIN,this,this.onGameWin),s.stage.on(e.GAME_RELIVE,this,this.onGameRelive),s.stage.on(e.GAME_OVER,this,this.onGameOver),s.stage.on(e.OPEN_WIN_VIEW,this,this.onOpenWinView),s.stage.on(e.OPEN_FAILED_VIEW,this,this.onOpenFailedView),s.stage.on(e.GAME_RESET_START,this,this.onGameOverToStart),s.stage.on(e.APP_SHOW,this,this.onGameShow),s.stage.on(e.APP_HIDE,this,this.onGameHide),s.stage.on(e.UI_VIEW_CLOSED,this,this.onViewClosed),s.stage.on(e.UI_VIEW_OPENED,this,this.onViewOpened),this.showLoading(null,s.Handler.create(this,this.onLoadingOpened))}static openView(t,e,i){if(null==this.viewCfg[t])return i&&i.run(),void console.warn("Invalid ViewId",t);s.Scene.open(this.viewCfg[t].url,!1,e,s.Handler.create(this,function(s){if(this.viewCfg[t].script){var n=s.getComponent(this.viewCfg[t].script);null==n&&(n=s.addComponent(this.viewCfg[t].script)),n.initView&&n.initView(e)}i&&i.run(),this.viewCfg[t].view=s}))}static closeView(t){null!=this.viewCfg[t]&&null!=this.viewCfg[t].view&&(this.viewCfg[t].view=null,s.Scene.close(this.viewCfg[t].url))}static showLoading(t,s){this.openView(i.Loading,t,s)}static go2Home(t,a){this.gameState!=n.STATE_UNBEGIN&&(this.gameState=n.STATE_UNBEGIN,this.reliveChance=2,this.isWin=!1,this.hook&&this.hook.on2Home?this.hook.on2Home(s.Handler.create(this,function(){s.stage.event(e.GAME_HOME),this.openView(i.Home,t,a)})):(s.stage.event(e.GAME_HOME),this.openView(i.Home,t,a)))}static go2Game(t,a){this.gameState!=n.STATE_PREPARE&&(this.gameState=n.STATE_PREPARE,this.appConfig.bgm&&c.playMusic(g.appConfig.bgm),this.hook&&this.hook.on2Game?this.hook.on2Game(s.Handler.create(this,function(){s.stage.event(e.GAME_PREPARE),this.openView(i.Game,t,a)})):(s.stage.event(e.GAME_PREPARE),this.openView(i.Game,t,a)))}static showSuccessed(t,s){this.gameState==n.STATE_PLAYING&&(this.gameState=n.STATE_PAUSE,this.isWin=!0,this.autoStartNext=!1,c.stopMusic(),this.openView(i.Success,t,s))}static showFailed(t,s){this.gameState==n.STATE_PLAYING&&(this.isWin=!1,this.autoStartNext=!1,c.stopMusic(),this.gameState=n.STATE_PAUSE,this.reliveChance-=1,this.openView(i.Failed,t,s))}static overGame(){this.gameState==n.STATE_PAUSE&&(this.gameState=n.STATE_OVER,this.isWin=!1,this.autoStartNext=!1,this.closeView(i.Game),this.closeView(i.Failed),this.closeView(i.Success),this.hook&&this.hook.onGameOver?this.hook.onGameOver(s.Handler.create(this,function(){s.stage.event(e.GAME_OVER),this.go2Home()})):(s.stage.event(e.GAME_OVER),this.go2Home()))}static startGame(){this.isWin=!1,this.autoStartNext=!1,this.gameState=n.STATE_PLAYING,s.stage.event(e.GAME_START)}static go2Relive(){this.gameState==n.STATE_PAUSE&&(this.gameState=n.STATE_PLAYING,this.appConfig.bgm&&c.playMusic(this.appConfig.bgm),this.hook&&this.hook.onRelive?this.hook.onRelive(s.Handler.create(this,function(){s.stage.event(e.GAME_RELIVE)})):s.stage.event(e.GAME_RELIVE))}static onViewClosed(t,s){}static onViewOpened(t,s){-1!=this.viewCfg[i.Home].url.indexOf(t)?this.closeView(i.Loading):-1!=this.viewCfg[i.Game].url.indexOf(t)&&this.closeView(i.Home)}static onLoadingOpened(){this.loadSubpackage()}static loadSubpackage(){this.appConfig.subpackage&&this.appConfig.subpackage.length>0?l.loadSubpackage(this.appConfig.subpackage,s.Handler.create(this,this.onSubpackageReady)):this.onSubpackageReady()}static onSubpackageReady(){this.appConfig.bgm&&c.playMusic(this.appConfig.bgm),this.loadBaseConfig(),this.appConfig.fontList&&this.appConfig.fontList.length>0&&l.loadFont(this.appConfig.fontList)}static loadBaseConfig(){this.appConfig.configList=this.appConfig.configList?this.appConfig.configList:[],this.netBaseCfgUrl&&this.appConfig.configList.push(this.appConfig.netBaseCfgUrl),this.netAdCfgUrl&&this.appConfig.configList.push(this.appConfig.netAdCfgUrl),0==this.appConfig.configList.length?this.onBaseConfigReady():l.loadResAsyn(this.appConfig.configList,s.Handler.create(this,this.onBaseConfigReady))}static onBaseConfigReady(){this.appConfig.netAdCfgUrl&&(this.adCfg=s.loader.getRes(this.appConfig.netAdCfgUrl)),this.appConfig.netBaseCfgUrl&&(this.baseCfg=s.loader.getRes(this.appConfig.netBaseCfgUrl)),this.loadBaseRes()}static loadBaseRes(){if(null==this.appConfig.baseResList||0==this.appConfig.baseResList.length)this.onBaseResReady();else{for(var t=[],e=0;e<this.appConfig.baseResList.length;e++)t.push(l.get3dResUrl(this.appConfig.baseResList[e]));l.load3dResAsyn(t,s.Handler.create(this,this.onBaseResReady))}}static onBaseResReady(){this.loadScene3d()}static loadScene3d(){null!=this.appConfig.default3DScene&&0!=this.appConfig.default3DScene.length?l.loadScene3dAsyn(this.appConfig.default3DScene,s.Handler.create(this,this.onLaunchResReady)):this.onLaunchResReady(null)}static onLaunchResReady(t){console.log("onLaunchResReady"),t&&(this.scene3d=s.stage.addChildAt(t,0)),s.stage.event(e.LAUNCH_COMPLETED),this.hook&&this.hook.onLaunchResReady?this.hook.onLaunchResReady(s.Handler.create(this,function(){this.go2Home()})):this.go2Home()}static onGameShow(){s.stage.renderingEnabled=!0,this.appConfig&&this.appConfig.bgm&&!c.IsBgmPlaying&&c.playMusic(this.appConfig.bgm)}static onGameHide(){s.stage.renderingEnabled=!1,c.stopAll()}}g.appConfig=null,g.playerInfo={},g.storeCfg={},g.baseCfg={},g.adCfg={},g.viewCfg={},g.scene3d=null,g.gameState=n.STATE_LOADING,g.reliveChance=2,g.autoStartNext=!1,g.isWin=!1,g.hook={},s.ILaya.regClass(g),s.ClassUtils.regClass("fc.framework.GameFrame",g),t.Audio=c,t.Device=o,t.Channel=r,t.Resource=l,t.Md5Utils=a,t.MiscUtils=h,t.WebRequest=d,t.GameFrame=g}(window.fc.framework,Laya);